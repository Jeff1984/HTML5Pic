<!DOCTYPE html>
 
<html>
 
<head>
    <div id="container"/>
    <meta http-equiv="content-type" content="text/html" charset="utf-8"/>
    <img id="HH" src="1.png" style="display: none"/>
    <img id="TS" src="2.png" style="display: none"/>
    <img id="MM" src="3.png" style="display: none"/>
    <img id="TQS" src="4.png" style="display: none"/>
    <img id="AK" src="5.png" style="display: none"/>
    <title>Take or select photo(s) and upload</title>
    <form method="post" accept-charset="utf-8" name="form1">
        <input name="hidden_data" id='hidden_data' type="hidden"/>
    </form>
    <body onmousedown="return false;">
	<script src="js/quark.base-1.0.0.js"></script>
    <script src="js/editableImage.js"></script>
    <script type="text/javascript">
		//create a DOMContext
		var container = Quark.getDOM("container");
		var domContext = new Quark.DOMContext({canvas:container});
        var mousePos;
        var events;
        const MAX_HEIGHT=800;
        const MAX_WIDTH=600;

		//or create a CanvasContext
		//var container = Quark.getDOM("container");
		var canvas = Quark.createDOM("canvas", {width:600, height:800, style:
		{
			position:"absolute",
			backgroundColor:"#000"
		}});
        //canvas.id="picture";
		container.appendChild(canvas);
		var canvasContext = new Quark.CanvasContext({canvas:canvas});

        //var canvas = document.getElementById('canvas');


		var stage = new Quark.Stage({width:600, height:800, context:domContext, update:function()
		{
		//write your own update code here
		}});

        container.addEventListener('mousemove', function(evt) {
            mousePos = getMousePos(container, evt);
            var message = 'Mouse position: ' + mousePos.x + ',' + mousePos.y;
            console.log( message);
        });

        function getMousePos(canvas, evt) {
            var rect = canvas.getBoundingClientRect();
            return {
                x: evt.clientX - rect.left,
                y: evt.clientY - rect.top
            };
        }
        var fps = 60;
        var timer = new Q.Timer(1000/fps);
        timer.addListener(stage);
        timer.start();

        var em = new Quark.EventManager();
        events= Quark.supportTouch ? ["touchstart", "touchmove", "touchend"] : ["mousedown", "mousemove", "mouseup"];
        em.registerStage(stage, events);

        var im=new editableImage("HH",{id:"edit",x:0,y:0,autoSize:true});
        stage.addChild(im);

        //files related
        function fileSelected() {

            var count = document.getElementById('fileToUpload').files.length;

            document.getElementById('details').innerHTML = "";

            for (var index = 0; index < count; index ++)

            {
                var file = document.getElementById('fileToUpload').files[index];
                this.loadFileToNewCanvas(file);
                var fileSize = 0;

                if (file.size > 1024 * 1024)

                    fileSize = (Math.round(file.size * 100 / (1024 * 1024)) / 100).toString() + 'MB';

                else

                    fileSize = (Math.round(file.size * 100 / 1024) / 100).toString() + 'KB';

                document.getElementById('details').innerHTML += 'Name: ' + file.name + '<br>Size: ' + fileSize + '<br>Type: ' + file.type;

                document.getElementById('details').innerHTML += '<p>';

            }
        }

        function loadFileToNewCanvas(file)
        {
            var ctx=canvas.getContext("2d");
            var img=new Image();
            img.src=window.URL.createObjectURL(file);
            img.onload=function(){
                ctx.clearRect(0,0,800,600);
                if(img.height>MAX_HEIGHT)
                {
                    img.height=MAX_HEIGHT;
                }
                if(img.width>MAX_WIDTH)
                {
                    img.width=MAX_WIDTH;
                }
                canvas.width=MAX_WIDTH;
                canvas.height=MAX_HEIGHT;
                ctx.drawImage(img,0,0,img.width,img.height);
            }
        }
 
    </script>
 
</head>
 
<body>
 
  <form id="form1" enctype="multipart/form-data">
 
    <div>
        <label for="fileToUpload">Take or select photo(s)</label>
        <div id="buttonContainer" style="margin-top: 1px; text-align: center;" >

            <input type="file" name="fileToUpload" id="fileToUpload" onchange="fileSelected();" accept="image/*" capture="camera"  style="margin-top: 800px"/>
            <input type="button" onclick="uploadFile()" value="Upload" />
            <input type="button" onclick="combinePic1()" value="花花" />
            <input type="button" onclick="combinePic2()" value="天使" />
            <input type="button" onclick="combinePic3()" value="喵喵" />
            <input type="button" onclick="combinePic4()" value="铁骑士" />
            <input type="button" onclick="combinePic5()" value="奥可" />

            <input type="button" onclick="copyCanvas()" value="CopyCanvas" />
        </div>
    </div>
 
    <div id="details"></div>
    <div id="progress"></div>
  </form>
 
</body>
 
</html>