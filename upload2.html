<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
     <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Upload Canvas Data to PHP Server</title>
    </head>
    <body>
 <h1>Upload Canvas Data to PHP Server</h1>
 <canvas width="80" height="80" id="canvas">canvas</canvas>
 <script type="text/javascript">
       window.onload = function() {
        var canvas = document.getElementById("canvas");
        var context = canvas.getContext("2d");
        context.rect(0, 0, 80, 80);
        context.fillStyle = 'yellow';
        context.fill();
       }
            </script>
<div>
    <input type="button" onclick="uploadEx()" value="Upload" />
    </div>
<form method="post" accept-charset="utf-8" name="form1">
   <input name="hidden_data" id='hidden_data' type="hidden"/>
    </form>
<script>

    function dataURLtoBlob(dataURL) {
        var byteString;
        if (dataURL.split(',')[0].indexOf('base64') >= 0) {
            byteString = atob(dataURL.split(',')[1]);
        }
        else {
            byteString = unescape(dataURL.split(',')[1]);
        }

        var mimeString=dataURL.split(',')[0].split(':')[1].split(';')[0];
        var ab=new ArrayBuffer(byteString.length);
        var ia=new Uint8Array(byteString.length);
        for(var i=0;i<byteString.length;i++){
            ia[i]=byteString.charCodeAt(i);
        }
        var _blob;
        try{
            _blob=new Blob([ia],{type:mimeString});
        }catch(e)
        {
            window.BlobBuilder = window.BlobBuilder ||
                    window.WebKitBlobBuilder ||
                    window.MozBlobBuilder ||
                    window.MSBlobBuilder;
            if(e.name == 'TypeError' && window.BlobBuilder){

                const TESTTXT=false;
                var bb = new BlobBuilder();
                if(TESTTXT){
                    bb.append("THIS is test");
                    _blob = bb.getBlob("text/plain");
                    // alert(_blob.type);
                }else {
                    bb.append(ia.buffer);

                    _blob = bb.getBlob("image/jpg");

                    //just a test
                }
            }
            else if(e.name == "InvalidStateError"){
                // InvalidStateError (tested on FF13 WinXP)
                _blob = new Blob(ia, {type :mimeString});
            }
            else{
                // We're screwed, blob constructor unsupported entirely
            }
        }
        alert(_blob.size)
        return _blob;
    }
    function uploadComplete(evt) {

        /* This event is raised when the server send back a response */
        alert(evt.target.responseText);

    }

    function uploadEx() {
        var canvas = document.getElementById("canvas");
        var dataURL = canvas.toDataURL("image/png");
        alert(dataURL);
        document.getElementById('hidden_data').value = dataURL;
        //var fd = new FormData(document.forms["form1"]);
        var fd=new FormData(document.forms[1]);
        var blob = dataURLtoBlob(dataURL);
        fd.append('myFile', blob);
        var xhr = new XMLHttpRequest();
        xhr.open('POST', 'savetofile.php', true);
        xhr.upload.onprogress = function(e) {
                    if (e.lengthComputable) {
                        var percentComplete = (e.loaded / e.total) * 100;
                        console.log(percentComplete + '% uploaded');
                        //alert('Succesfully uploaded');
                        }
                    };
        xhr.addEventListener("load", uploadComplete, false);

        xhr.onload = function() {
                    };
       xhr.send(fd);
       };
    </script>
</body>
</html>